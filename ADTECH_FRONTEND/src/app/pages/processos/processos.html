<!-- Processos - Página no padrão do Dashboard -->
<div class="processos-container dashboard-hero">
  <div class="hero-flare"></div>
  <div class="hero-flare-secondary"></div>
  <div class="hero-triangle-pattern"></div>

  <!-- Dropdown do Profile -->
  @if (showProfileMenu) {
    <div class="profile-dropdown">
      <div class="profile-menu-item" (click)="goToSettings($event)">
        <ion-icon name="settings-outline"></ion-icon>
        <span>Configurações</span>
      </div>
      <div class="profile-menu-item logout-item" (click)="logout()">
        <ion-icon name="log-out-outline"></ion-icon>
        <span>Sair</span>
      </div>
    </div>
  }

  <!-- Menu Lateral -->
  <div class="navigation">
    <ul>
      <li>
        <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <span class="icon"><ion-icon name="grid-outline"></ion-icon></span>
          <span class="title">Geral</span>
        </a>
      </li>
      <li>
        <a routerLink="/processos" routerLinkActive="active">
          <span class="icon"><ion-icon name="folder-open-outline"></ion-icon></span>
          <span class="title">Processos</span>
        </a>
      </li>
      <li>
        <a routerLink="/clientes" routerLinkActive="active">
          <span class="icon"><ion-icon name="people-outline"></ion-icon></span>
          <span class="title">Clientes</span>
        </a>
      </li>
      <li>
        <a routerLink="/calendar" routerLinkActive="active">
          <span class="icon"><ion-icon name="calendar-outline"></ion-icon></span>
          <span class="title">Agenda</span>
        </a>
      </li>
      <li>
        <a href="#">
          <span class="icon"><ion-icon name="stats-chart-outline"></ion-icon></span>
          <span class="title">Relatórios</span>
        </a>
      </li>
      <li>
        <a href="#">
          <span class="icon"><ion-icon name="wallet-outline"></ion-icon></span>
          <span class="title">Financeiro</span>
        </a>
      </li>
      <li>
        <a routerLink="/documentos" routerLinkActive="active">
          <span class="icon"><ion-icon name="document-text-outline"></ion-icon></span>
          <span class="title">Documentos</span>
        </a>
      </li>
      <li>
        <a href="#">
          <span class="icon"><ion-icon name="settings-outline"></ion-icon></span>
          <span class="title">Configurações</span>
        </a>
      </li>
    </ul>
  </div>

  <!-- Área Principal -->
  <div class="main">
    <div class="topbar">
      <div class="toggle">
        <ion-icon name="menu-outline"></ion-icon>
      </div>
      <div class="search">
        <label>
          <input
            type="text"
            placeholder="Pesquisar processos..."
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearch()"
          />
          <ion-icon name="search-outline"></ion-icon>
        </label>
      </div>
      <div class="notification-icon">
        <ion-icon name="notifications-outline"></ion-icon>
        <span class="notification-badge">3</span>
      </div>
      <div class="user-profile" (click)="toggleProfileMenu($event)">
        <ion-icon name="person-outline"></ion-icon>
      </div>
    </div>

    <!-- Header da Página -->
    <div class="page-header">
      <div class="header-content">
        <h1>
          <ion-icon name="document-text-outline"></ion-icon>
          Processos
        </h1>
        <p>Gerencie registros, averbações e demais atos cartorários</p>
      </div>
      <button class="btn-primary" (click)="novoProcesso()">
        <ion-icon name="add-circle-outline"></ion-icon>
        Novo Processo
      </button>
    </div>

    <!-- Filtros Inteligentes -->
    <div class="filters-container">
      <!-- Linha Única: Chips + Filtros Avançados -->
      <div class="filters-row">
        <div class="quick-filters">
          <button
            class="filter-chip"
            [class.active]="filtroStatus === 'todos'"
            (click)="aplicarFiltroStatus('todos')">
            <ion-icon name="albums-outline"></ion-icon>
            Todos
            <span class="badge">{{getTotalProcessos()}}</span>
          </button>
          <button
            class="filter-chip"
            [class.active]="filtroStatus === 'aguardando'"
            (click)="aplicarFiltroStatus('aguardando')">
            <ion-icon name="hourglass-outline"></ion-icon>
            Aguardando
            <span class="badge warning">{{getCountByStatus('aguardando')}}</span>
          </button>
          <button
            class="filter-chip"
            [class.active]="filtroStatus === 'analise'"
            (click)="aplicarFiltroStatus('analise')">
            <ion-icon name="search-outline"></ion-icon>
            Em Análise
            <span class="badge info">{{getCountByStatus('analise')}}</span>
          </button>
          <button
            class="filter-chip"
            [class.active]="filtroStatus === 'pendente'"
            (click)="aplicarFiltroStatus('pendente')">
            <ion-icon name="alert-circle-outline"></ion-icon>
            Pendente
            <span class="badge danger">{{getCountByStatus('pendente')}}</span>
          </button>
          <button
            class="filter-chip"
            [class.active]="filtroStatus === 'concluido'"
            (click)="aplicarFiltroStatus('concluido')">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            Concluído
            <span class="badge success">{{getCountByStatus('concluido')}}</span>
          </button>
        </div>

        <!-- Botão Filtros Avançados NA MESMA LINHA -->
        <button class="filter-chip filter-advanced-btn" (click)="toggleFiltrosAvancados()">
          <ion-icon name="options-outline"></ion-icon>
          Filtros Avançados
          <ion-icon [name]="mostrarFiltrosAvancados ? 'chevron-up-outline' : 'chevron-down-outline'"></ion-icon>
        </button>
      </div>

      <!-- Painel Filtros Avançados (Expandido abaixo) -->
      @if (mostrarFiltrosAvancados) {
        <div class="advanced-filters-panel">
          <div class="filter-group">
            <label>
              <ion-icon name="document-outline"></ion-icon>
              Tipo de Ato
            </label>
            <select [(ngModel)]="filtroTipo" (change)="aplicarFiltros()">
              <option value="">Todos os tipos</option>
              <option value="Registro">Registro</option>
              <option value="Averbação">Averbação</option>
              <option value="Certidão">Certidão</option>
              <option value="Escritura">Escritura</option>
              <option value="Procuração">Procuração</option>
              <option value="Testamento">Testamento</option>
            </select>
          </div>

          <div class="filter-group">
            <label>
              <ion-icon name="flag-outline"></ion-icon>
              Prioridade
            </label>
            <select [(ngModel)]="filtroPrioridade" (change)="aplicarFiltros()">
              <option value="">Todas</option>
              <option value="Alta">Alta</option>
              <option value="Média">Média</option>
              <option value="Baixa">Baixa</option>
            </select>
          </div>

          <div class="filter-group">
            <label>
              <ion-icon name="calendar-outline"></ion-icon>
              Período
            </label>
            <select [(ngModel)]="filtroPeriodo" (change)="aplicarFiltros()">
              <option value="">Todo período</option>
              <option value="hoje">Hoje</option>
              <option value="semana">Esta semana</option>
              <option value="mes">Este mês</option>
              <option value="trimestre">Último trimestre</option>
            </select>
          </div>

          <div class="filter-group">
            <label>
              <ion-icon name="person-outline"></ion-icon>
              Responsável
            </label>
            <select [(ngModel)]="filtroResponsavel" (change)="aplicarFiltros()">
              <option value="">Todos</option>
              <option value="João Santos">João Santos</option>
              <option value="Ana Costa">Ana Costa</option>
              <option value="Carlos Lima">Carlos Lima</option>
            </select>
          </div>

          <div class="filter-actions">
            <button class="btn-clear" (click)="limparFiltros()">
              <ion-icon name="close-circle-outline"></ion-icon>
              Limpar Filtros
            </button>
            <button class="btn-apply" (click)="aplicarFiltros()">
              <ion-icon name="funnel-outline"></ion-icon>
              Aplicar Filtros
            </button>
          </div>
        </div>
      }

      <!-- Ações -->
      <div class="actions-toolbar">
        <div class="view-options">
          <button
            class="view-btn"
            [class.active]="viewMode === 'grid'"
            (click)="changeViewMode('grid')"
            title="Visualização em Grade">
            <ion-icon name="grid-outline"></ion-icon>
          </button>
          <button
            class="view-btn"
            [class.active]="viewMode === 'list'"
            (click)="changeViewMode('list')"
            title="Visualização em Lista">
            <ion-icon name="list-outline"></ion-icon>
          </button>
        </div>

        <div class="action-buttons">
          <button class="btn-action" (click)="exportarPDF()">
            <ion-icon name="document-text-outline"></ion-icon>
            <span>PDF</span>
          </button>
          <button class="btn-action" (click)="exportarExcel()">
            <ion-icon name="stats-chart-outline"></ion-icon>
            <span>Excel</span>
          </button>
          <button class="btn-action" (click)="imprimirRelatorio()">
            <ion-icon name="print-outline"></ion-icon>
            <span>Imprimir</span>
          </button>
        </div>
      </div>
    </div>

    <!-- TABELA ÚNICA -->
    <div class="table-responsive-wrapper">
      <div class="tabela-processos-alinhada">
        <table class="processos-table">
        <thead>
          <tr>
            <th class="col-expand"></th>
            <th>Nº PROCESSO</th>
            <th>TIPO</th>
            <th>SOLICITANTE</th>
            <th>DATA</th>
            <th>STATUS</th>
            <th>PRIORIDADE</th>
            <th>RESPONSÁVEL</th>
            <th>PRAZO</th>
            <th>AÇÕES</th>
          </tr>
        </thead>
        <tbody>
          @for (processo of processosFiltrados; track processo.numero) {
            <!-- LINHA PRINCIPAL -->
            <tr class="linha-principal" [class.expandida]="processo.expanded">
              <td>
                <button class="btn-expand" (click)="toggleProcesso(processo)">
                  <ion-icon [name]="processo.expanded ? 'chevron-up-outline' : 'chevron-down-outline'"></ion-icon>
                </button>
              </td>
              <td>{{processo.numero}}</td>
              <td>{{processo.tipo}}</td>
              <td>{{processo.cliente}}</td>
              <td>{{processo.dataAbertura}}</td>
              <td>{{processo.status}}</td>
              <td>{{processo.prioridade}}</td>
              <td>{{processo.responsavel}}</td>
              <td>{{processo.proximaAudiencia || '-'}}</td>
              <td>
                <button class="btn-icon" (click)="viewProcess(processo); $event.stopPropagation()" title="Visualizar">
                  <ion-icon name="eye-outline"></ion-icon>
                </button>
                <button class="btn-icon" (click)="editProcess(processo); $event.stopPropagation()" title="Editar">
                  <ion-icon name="create-outline"></ion-icon>
                </button>
              </td>
            </tr>

            <!-- LINHA EXPANDIDA (DETALHES) -->
            @if (processo.expanded) {
              <tr class="linha-detalhes">
                <td colspan="10" class="td-detalhes">
                  <div class="detalhes-container">

                    <!-- SEÇÃO 1: DETALHES DO PROCESSO -->
                    <div class="secao detalhes">
                      <div class="secao-header">
                        <ion-icon name="document-text-outline" class="icone"></ion-icon>
                        <h3>DETALHES DO PROCESSO</h3>
                      </div>
                      <div class="info-grid">
                        <div class="info-item">
                          <span class="label">Nº do Processo:</span>
                          <span class="value">{{processo.numero}}</span>
                        </div>
                        <div class="info-item">
                          <span class="label">Tipo:</span>
                          <span class="value">{{processo.tipo}}</span>
                        </div>
                        <div class="info-item">
                          <span class="label">Livro/Folha:</span>
                          <span class="value">Livro 3-A / Folha 120</span>
                        </div>
                        <div class="info-item">
                          <span class="label">Valor da Causa:</span>
                          <span class="value">{{processo.valorCausa}}</span>
                        </div>
                        <div class="info-item">
                          <span class="label">Forma de Pagamento:</span>
                          <span class="value">Boleto Bancário</span>
                        </div>
                        <div class="info-item">
                          <span class="label">Status:</span>
                          <span class="value status-badge" [class]="processo.statusClass">{{processo.status}}</span>
                        </div>
                        <div class="info-item full-width">
                          <span class="label">Observações:</span>
                          <span class="value">Processo em tramitação normal. Aguardando análise documental.</span>
                        </div>
                      </div>
                    </div>

                    <!-- SEÇÃO 2: PARTES ENVOLVIDAS -->
                    <div class="secao partes">
                      <div class="secao-header">
                        <ion-icon name="people-outline" class="icone"></ion-icon>
                        <h3>PARTES ENVOLVIDAS</h3>
                      </div>
                      <div class="partes-grid">
                        <div class="parte-card">
                          <span class="parte-tipo">Solicitante</span>
                          <span class="parte-nome">{{processo.cliente}}</span>
                          <span class="parte-info">CPF: 123.456.789-00</span>
                          <span class="parte-info">Tel: (11) 98765-4321</span>
                        </div>
                        <div class="parte-card">
                          <span class="parte-tipo">Responsável</span>
                          <span class="parte-nome">{{processo.responsavel}}</span>
                          <span class="parte-info">OAB/SP 123.456</span>
                          <span class="parte-info">Email: advogado@exemplo.com</span>
                        </div>
                      </div>
                    </div>

                    <!-- SEÇÃO 3: DOCUMENTOS ANEXADOS -->
                    <div class="secao documentos">
                      <div class="secao-header">
                        <ion-icon name="attach-outline" class="icone"></ion-icon>
                        <h3>DOCUMENTOS ANEXADOS</h3>
                      </div>
                      <div class="documentos-list">
                        <div class="documento-item">
                          <ion-icon name="document-outline" class="doc-icone"></ion-icon>
                          <div class="doc-info">
                            <span class="doc-nome">RG_Frente.pdf</span>
                            <span class="doc-tamanho">1.2 MB • Enviado em 15/01/2024</span>
                          </div>
                          <button class="btn-download">
                            <ion-icon name="download-outline"></ion-icon>
                            Download
                          </button>
                        </div>
                        <div class="documento-item">
                          <ion-icon name="document-outline" class="doc-icone"></ion-icon>
                          <div class="doc-info">
                            <span class="doc-nome">CPF.pdf</span>
                            <span class="doc-tamanho">890 KB • Enviado em 15/01/2024</span>
                          </div>
                          <button class="btn-download">
                            <ion-icon name="download-outline"></ion-icon>
                            Download
                          </button>
                        </div>
                        <div class="documento-item">
                          <ion-icon name="document-outline" class="doc-icone"></ion-icon>
                          <div class="doc-info">
                            <span class="doc-nome">Comprovante_Residencia.pdf</span>
                            <span class="doc-tamanho">2.5 MB • Enviado em 16/01/2024</span>
                          </div>
                          <button class="btn-download">
                            <ion-icon name="download-outline"></ion-icon>
                            Download
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- SEÇÃO 4: HISTÓRICO/TIMELINE -->
                    <div class="secao historico">
                      <div class="secao-header">
                        <ion-icon name="time-outline" class="icone"></ion-icon>
                        <h3>HISTÓRICO</h3>
                      </div>
                      <div class="timeline">
                        <div class="timeline-item">
                          <div class="timeline-marker"></div>
                          <div class="timeline-content">
                            <div class="timeline-timestamp">{{processo.dataAbertura}} 14:30</div>
                            <div class="timeline-evento">Processo criado e cadastrado no sistema</div>
                            <div class="timeline-usuario">por {{processo.responsavel}}</div>
                          </div>
                        </div>
                        <div class="timeline-item">
                          <div class="timeline-marker"></div>
                          <div class="timeline-content">
                            <div class="timeline-timestamp">{{processo.dataAbertura}} 15:15</div>
                            <div class="timeline-evento">Documentos anexados (RG, CPF, Comprovante)</div>
                            <div class="timeline-usuario">por {{processo.responsavel}}</div>
                          </div>
                        </div>
                        <div class="timeline-item">
                          <div class="timeline-marker"></div>
                          <div class="timeline-content">
                            <div class="timeline-timestamp">{{processo.dataAbertura}} 16:45</div>
                            <div class="timeline-evento">Status alterado para: {{processo.status}}</div>
                            <div class="timeline-usuario">por Sistema Automático</div>
                          </div>
                        </div>
                        <div class="timeline-item">
                          <div class="timeline-marker"></div>
                          <div class="timeline-content">
                            <div class="timeline-timestamp">05/12/2024 10:20</div>
                            <div class="timeline-evento">Prioridade definida como: {{processo.prioridade}}</div>
                            <div class="timeline-usuario">por {{processo.responsavel}}</div>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
      </div>
    </div>

      <!-- Paginação -->
      <div class="pagination">
        <div class="pagination-info">
          Mostrando {{(currentPage - 1) * itemsPerPage + 1}} a {{Math.min(currentPage * itemsPerPage, processosFiltrados.length)}} de {{processosFiltrados.length}} processos
        </div>
        <div class="pagination-controls">
          <button class="btn-page" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
            <ion-icon name="chevron-back-outline"></ion-icon>
          </button>
          <span class="page-numbers">
            @for (page of getPageNumbers(); track page) {
              <button
                class="btn-page-number"
                [class.active]="page === currentPage"
                (click)="changePage(page)">
                {{page}}
              </button>
            }
          </span>
          <button class="btn-page" [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
            <ion-icon name="chevron-forward-outline"></ion-icon>
          </button>
        </div>
      </div>

      <!-- Vazio -->
      @if (processosFiltrados.length === 0) {
        <div class="empty-state">
          <ion-icon name="folder-open-outline"></ion-icon>
          <h3>Nenhum processo encontrado</h3>
          <p>Não há processos {{filtroStatus !== 'todos' ? 'com o status ' + filtroStatus : 'cadastrados'}} no momento.</p>
          <button class="btn-primary" (click)="novoProcesso()">
            <ion-icon name="add-circle-outline"></ion-icon>
            Criar Primeiro Processo
          </button>
        </div>
      }
  </div>
</div>
